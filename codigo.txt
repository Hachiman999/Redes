const express = require('express'),
    multer = require('multer'),
    storage = multer.diskStorage({
        destination: function (req, file, cb) {
            cb(null, './archivos')
        },
        filename: function (req, file, cb) {
            cb(null, file.originalname)
        }
    }),
    upload = multer({storage}),
    app = express();

app.get('/', (req, res) => {
    res.sendFile('/index.html', { root: __dirname })
})

app.post('/subir', upload.single('archivo'), (req, res) => {
    console.log(req.file) // Nos devuelve un objeto con la información de nuestro archivo
    res.send('Archivo subido correctamente')
})

app.post('/multiple', upload.array('archivo', 2), (req, res) => {
    console.log(req.files)
    res.send('Archivos subidos exitosamente')
})

let dobleInput = upload.fields([{ name: 'archivo', maxCount: 3 }, { name: 'fichero' }])
app.post('/doble-input', dobleInput, (req, res) => {
    console.log(req.files) // Nos devuelve un arreglo de la información de los input
    res.send('Archivos subidos exitosamente')
})

app.listen(3000, () => console.log('SERVIDOR FUNCIONANDO'))
------------------------------------

const express = require('express');
const path = require('path')
//const ejs = require('ejs'); 
const multer = require('multer')

const app = express();//iniciamos el servidor

const http = require('http').Server(app);//aplicamos el protocolo http

//Configuracion de rutas de archivos
app.set('view engine', 'ejs');
app.set('views', path.join(__dirname,'views'))

//configurar multer
const coleccion = multer.diskStorage({
    filename: (req,file,cb)=>{
        cb(null, file.originalname)
    }
});

//procesamiento de la imagen
const subida = multer({
    dest:path.join(__dirname,'public')
}).single('image');


//Configuracion de rutas del servidor
app.get('/', (req, res) =>{
    //se le dice que por defecto cargue index.html
    res.render('index'); 
    });


app.post('/subir',subida, (req, res) =>{
   console.log(req.file);
    res.send('subido');
});


//iniciamos el servidor
const PORT =80; 


http.listen(PORT ,()=>{
    console.log(`Servidor iniciado en el puerto ${PORT}`)
});